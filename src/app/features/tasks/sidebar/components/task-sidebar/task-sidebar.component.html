<aside class="task-sidebar">
    <div class="control-panel">
        <div class="control-group">
            <label>Base repository</label>
            <div class="repo-info" *ngIf="baseRepo; else noRepo">
                <a
                    href="#"
                    class="path-link"
                    (click)="openInExplorer($event, baseRepo.canonicalPath)"
                    [attr.title]="baseRepo.canonicalPath"
                >
                    {{ baseRepo.canonicalPath }}
                </a>
                <span class="branch">Branch: {{ baseRepo.currentBranch }}</span>
            </div>
            <div class="repo-actions" *ngIf="baseRepo">
                <app-open-vscode-button
                    [path]="baseRepo.canonicalPath"
                    title="Open repository in VS Code"
                    ariaLabel="Open repository in VS Code"
                ></app-open-vscode-button>
                <app-open-terminal-button
                    [path]="baseRepo.canonicalPath"
                    title="Open repository terminal"
                    ariaLabel="Open repository terminal"
                ></app-open-terminal-button>
            </div>
            <ng-template #noRepo>
                <span class="placeholder">No repository selected</span>
            </ng-template>
        </div>
    </div>

    <div class="sidebar-header">
        <div class="title-group">
            <span class="title">Tasks</span>
            <button
                type="button"
                class="icon ghost"
                (click)="createTask.emit()"
                [disabled]="!baseRepo"
                title="Create task"
                aria-label="Create task"
            >
                +
            </button>
        </div>
        <span class="count">{{ tasks?.length || 0 }}</span>
    </div>

    <div class="task-list" *ngIf="tasks?.length; else emptyState">
        <div
            *ngFor="let task of tasks; trackBy: trackById"
            class="task-row"
            [class.selected]="task.taskId === selectedTaskId"
            (click)="onSelect(task.taskId)"
        >
            <div class="row-main" *ngIf="titleParts(task.title) as parts">
                <div class="row-title">
                    <span *ngIf="parts.taskId" class="task-pill"
                        >#{{ parts.taskId }}</span
                    >
                    <span class="title-text">{{ parts.label }}</span>
                </div>
            </div>

            <div class="row-meta">
                <small class="branch">{{ task.branchName }}</small>
                <div class="actions">
                    <app-task-action-button
                        type="stop"
                        [disabled]="!isRunning(task.status)"
                        [loading]="stopLoadingIds.has(task.taskId)"
                        [stopPropagation]="true"
                        (action)="onStop(task.taskId)"
                    ></app-task-action-button>
                    <app-task-action-button
                        type="discard"
                        [stopPropagation]="true"
                        (action)="onDiscard(task.taskId)"
                    ></app-task-action-button>
                    <span class="status" [attr.data-status]="task.status">
                        {{ statusLabel(task.status) }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <ng-template #emptyState>
        <p class="empty">Create a task to get started.</p>
    </ng-template>
</aside>
