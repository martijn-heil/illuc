<div class="app-shell">
  <main class="content">
    <app-workflow-sidebar
      *ngIf="baseRepo() as repo"
      [workflows]="workflows()"
      [selectedWorkflowId]="workflowStore.selectedWorkflowId()"
      [baseRepo]="repo"
      (createWorkflow)="openCreateWorkflowModal()"
      (selectWorkflow)="selectWorkflow($event)"
      (startWorkflow)="startWorkflow($event)"
      (stopWorkflow)="stopWorkflow($event)"
      (discardWorkflow)="discardWorkflow($event)"
    ></app-workflow-sidebar>

    <app-workflow-view
      class="workflow-view"
      [workflow]="selectedWorkflow()"
      [baseRepo]="baseRepo()"
      (startWorkflow)="startWorkflow($event)"
      (stopWorkflow)="stopWorkflow($event)"
      (discardWorkflow)="discardWorkflow($event)"
      (openInVsCode)="openWorkflowInVsCode($event)"
      (openTerminal)="openWorkflowTerminal($event)"
      (selectBaseRepo)="browseForRepo()"
    ></app-workflow-view>
  </main>

  <footer class="status-bar" *ngIf="statusMessage">
    {{ statusMessage }}
  </footer>

  <div class="modal-backdrop" *ngIf="showCreateModal">
    <div class="modal">
      <h3>Create Workflow</h3>
      <p class="modal-subtitle">Provide the Git branch name for this workflow.</p>
      <label class="input-label">Branch name</label>
      <input
        type="text"
        [(ngModel)]="branchNameInput"
        placeholder="e.g. feature/25323-fancy-feature-name"
      />
      <div class="error" *ngIf="branchNameError">{{ branchNameError }}</div>
      <div class="modal-actions">
        <button type="button" class="ghost" (click)="closeCreateWorkflowModal()">Cancel</button>
        <button type="button" class="primary" (click)="submitNewWorkflow()">Create Workflow</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="confirmDiscardWorkflowId">
    <div class="modal">
      <h3>Discard workflow?</h3>
      <p class="modal-subtitle">
        This will remove the worktree and discard all changes for
        <strong>{{ confirmDiscardTitle }}</strong>
        <span *ngIf="confirmDiscardBranch">({{ confirmDiscardBranch }})</span>. This action cannot be undone.
      </p>
      <div class="error" *ngIf="confirmDiscardError">{{ confirmDiscardError }}</div>
      <div class="modal-actions">
        <button type="button" class="ghost" (click)="cancelDiscardWorkflow()">Cancel</button>
        <button type="button" class="primary warn" (click)="confirmDiscardWorkflow()">Discard</button>
      </div>
    </div>
  </div>
</div>
