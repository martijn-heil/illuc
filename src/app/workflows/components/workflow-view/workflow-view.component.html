<ng-container *ngIf="workflow as current; else emptyState">
  <section class="workflow-detail">
    <header class="workflow-header">
      <div *ngIf="titleParts() as parts">
        <h2>
          <span *ngIf="parts.taskId" class="task-pill">#{{ parts.taskId }}</span>
          <span>{{ parts.label }}</span>
        </h2>
        <p class="meta">
          Branch: <strong>{{ current.branchName }}</strong> • Worktree:
          <code>{{ current.worktreePath }}</code>
        </p>
      </div>
      <div class="header-actions">
        <div class="workspace-actions">
          <button
            type="button"
            class="ghost icon-btn"
            (click)="onOpenVsCode()"
            title="Open in VS Code"
            aria-label="Open in VS Code"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <polyline points="7 8 3 12 7 16"></polyline>
              <polyline points="17 8 21 12 17 16"></polyline>
              <line x1="14" y1="4" x2="10" y2="20"></line>
            </svg>
          </button>
          <button
            type="button"
            class="ghost icon-btn"
            (click)="onOpenTerminal()"
            title="Open terminal"
            aria-label="Open terminal"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <rect x="3" y="5" width="18" height="14" rx="2"></rect>
              <polyline points="7 9 11 12 7 15"></polyline>
              <line x1="12.5" y1="15" x2="17" y2="15"></line>
            </svg>
          </button>
        </div>
        <span class="status-pill" [attr.data-status]="current.status">
          {{ statusLabel() }}
        </span>
        <app-workflow-action-button
          type="start"
          [disabled]="!canStart()"
          (action)="onStart()"
        ></app-workflow-action-button>
        <app-workflow-action-button
          type="stop"
          [disabled]="!isRunning()"
          (action)="onStop()"
        ></app-workflow-action-button>
        <app-workflow-action-button
          type="discard"
          (action)="onDiscard()"
        ></app-workflow-action-button>
      </div>
    </header>

    <div class="split-panels">
      <div class="terminal-column">
        <app-workflow-terminal [workflowId]="current.workflowId"></app-workflow-terminal>
      </div>
      <div class="diff-column">
        <app-workflow-diff [workflowId]="current.workflowId"></app-workflow-diff>
      </div>
    </div>
  </section>
</ng-container>

<ng-template #emptyState>
  <div class="empty-view">
    <div class="landing-card">
      <div class="compass-logo" aria-hidden="true">
        <svg viewBox="0 0 200 200" role="presentation" focusable="false">
          <circle class="compass-ring outer" cx="100" cy="100" r="70" />
          <circle class="compass-ring inner" cx="100" cy="100" r="48" />
          <line class="compass-axis" x1="100" y1="20" x2="100" y2="180" />
          <line class="compass-axis" x1="20" y1="100" x2="180" y2="100" />
          <path
            class="compass-needle"
            d="M100 40 L124 100 L100 160 L76 100 Z"
            transform="rotate(45 100 100)"
          />
          <circle class="compass-core" cx="100" cy="100" r="6" />
        </svg>
      </div>
      <div class="landing-text">
        <h1>illuc</h1>
        <p class="etymology">„thither, to that place, to there“</p>
        <p class="subtitle">
          Select a base repository to load managed worktrees, then choose an existing workflow or create a new branch to get started.
        </p>
        <button
          type="button"
          class="primary landing-action"
          *ngIf="!baseRepo"
          (click)="onSelectBaseRepo()"
        >
          Select repository
        </button>
      </div>
    </div>
  </div>
</ng-template>
